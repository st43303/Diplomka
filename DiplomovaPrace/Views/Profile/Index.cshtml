@model DiplomovaPrace.Models.User

@{
    ViewBag.Title = Model.Username;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>@Model.Username</h2>

@if (ViewBag.Error != null)
{
<div class="alert alert-danger">
    <strong>@ViewBag.Error</strong>
</div>
}


@using (Html.BeginForm("Index","Profile",FormMethod.Post,new { enctype="multipart/form-data", @autocomplete="off"}))
{
    @Html.AntiForgeryToken()
    
<div class="form-horizontal">
    <div class="avatar-border">
        <img src="@Model.Avatar" id="myAvatar" alt="Profilový obrázek" style="width: 100%; height: 100%" />
    </div>

    <div class="form-group">
        @Html.Label("Profilový obrázek")
        <input type="file" onchange="imageChanged()" accept="image/*" class="form-control" style="height: auto" id="imageAvatar" name="AvatarFile" />
        <input type="reset" id="reset" style="display: none" />

    </div>
    <div class="alert alert-danger" id="alert" style="display: none">
        Maximální velikost souboru je 4 MB
    </div>
    <hr />
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.ID)

    <div class="form-group">
        @Html.LabelFor(model => model.Name)
        @Html.EditorFor(model => model.Name, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.Name, "", new { @class = "text-danger" })

    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.Surname)
        @Html.EditorFor(model => model.Surname, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.Surname, "", new { @class = "text-danger" })

    </div>

    <div class="form-group">
        @Html.LabelFor(model => model.BirthDate)
        @if (Model.BirthDate != null)
        {
            @Html.EditorFor(model => model.BirthDate, new { htmlAttributes = new { @class = "form-control", @id = "datepicker", @Value = Model.BirthDate.Value.ToShortDateString() } })
        }
        else
        {
            @Html.EditorFor(model => model.BirthDate, new { htmlAttributes = new { @class = "form-control", @id = "datepicker" } })

        }
        @Html.ValidationMessageFor(model => model.BirthDate, "", new { @class = "text-danger" })

    </div>

    <div class="form-group">
        @Html.LabelFor(model=>model.City)
        @Html.EditorFor(model => model.City, new { htmlAttributes = new { @class = "form-control" } })
        @Html.ValidationMessageFor(model => model.City, "", new { @class = "text-danger" })
    </div>

    <div class="form-group">
        <input type="submit" value="Uložit změny" class="btn btn-success btn-block" />
    </div>
</div>
}



@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script>

        function imageChanged() {
            if (checkSize()) {
                var input = document.getElementById("imageAvatar");
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = imageIsLoaded;
                    reader.readAsDataURL(input.files[0]);
                }
            }
         
        }

        function checkSize() {
            var file = document.getElementById("imageAvatar");
            var size = file.files[0].size;
            if (size > 4000000) {
                document.getElementById("alert").style.display = "block";
                document.getElementById("reset").click();
                return true;
            } else {
                document.getElementById("alert").style.display = "none";
                return false;
            }
        }
     

        function imageIsLoaded(e) {
            document.getElementById("myAvatar").src = e.target.result;
        };
    </script>
}
